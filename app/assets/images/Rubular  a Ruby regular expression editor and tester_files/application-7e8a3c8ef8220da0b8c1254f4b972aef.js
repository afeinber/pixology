/*  Prototype JavaScript framework, version 1.5.0
 *  (c) 2005-2007 Sam Stephenson
 *
 *  Prototype is freely distributable under the terms of an MIT-style license.
 *  For details, see the Prototype web site: http://prototype.conio.net/
 *
/*--------------------------------------------------------------------------*/
function $w(a){return a=a.strip(),a?a.split(/\s+/):[]}function $H(a){return a&&a.constructor==Hash?a:new Hash(a)}function $(a){if(arguments.length>1){for(var b=0,c=[],d=arguments.length;b<d;b++)c.push($(arguments[b]));return c}return typeof a=="string"&&(a=document.getElementById(a)),Element.extend(a)}function $$(){return Selector.findChildElements(document,$A(arguments))}var Prototype={Version:"1.5.0",BrowserFeatures:{XPath:!!document.evaluate},ScriptFragment:"(?:<script.*?>)((\n|\r|.)*?)(?:</script>)",emptyFunction:function(){},K:function(a){return a}},Class={create:function(){return function(){this.initialize.apply(this,arguments)}}},Abstract=new Object;Object.extend=function(a,b){for(var c in b)a[c]=b[c];return a},Object.extend(Object,{inspect:function(a){try{return a===undefined?"undefined":a===null?"null":a.inspect?a.inspect():a.toString()}catch(b){if(b instanceof RangeError)return"...";throw b}},keys:function(a){var b=[];for(var c in a)b.push(c);return b},values:function(a){var b=[];for(var c in a)b.push(a[c]);return b},clone:function(a){return Object.extend({},a)}}),Function.prototype.bind=function(){var a=this,b=$A(arguments),c=b.shift();return function(){return a.apply(c,b.concat($A(arguments)))}},Function.prototype.bindAsEventListener=function(a){var b=this,c=$A(arguments),a=c.shift();return function(d){return b.apply(a,[d||window.event].concat(c).concat($A(arguments)))}},Object.extend(Number.prototype,{toColorPart:function(){var a=this.toString(16);return this<16?"0"+a:a},succ:function(){return this+1},times:function(a){return $R(0,this,!0).each(a),this}});var Try={these:function(){var a;for(var b=0,c=arguments.length;b<c;b++){var d=arguments[b];try{a=d();break}catch(e){}}return a}},PeriodicalExecuter=Class.create();PeriodicalExecuter.prototype={initialize:function(a,b){this.callback=a,this.frequency=b,this.currentlyExecuting=!1,this.registerCallback()},registerCallback:function(){this.timer=setInterval(this.onTimerEvent.bind(this),this.frequency*1e3)},stop:function(){if(!this.timer)return;clearInterval(this.timer),this.timer=null},onTimerEvent:function(){if(!this.currentlyExecuting)try{this.currentlyExecuting=!0,this.callback(this)}finally{this.currentlyExecuting=!1}}},String.interpret=function(a){return a==null?"":String(a)},Object.extend(String.prototype,{gsub:function(a,b){var c="",d=this,e;b=arguments.callee.prepareReplacement(b);while(d.length>0)(e=d.match(a))?(c+=d.slice(0,e.index),c+=String.interpret(b(e)),d=d.slice(e.index+e[0].length)):(c+=d,d="");return c},sub:function(a,b,c){return b=this.gsub.prepareReplacement(b),c=c===undefined?1:c,this.gsub(a,function(a){return--c<0?a[0]:b(a)})},scan:function(a,b){return this.gsub(a,b),this},truncate:function(a,b){return a=a||30,b=b===undefined?"...":b,this.length>a?this.slice(0,a-b.length)+b:this},strip:function(){return this.replace(/^\s+/,"").replace(/\s+$/,"")},stripTags:function(){return this.replace(/<\/?[^>]+>/gi,"")},stripScripts:function(){return this.replace(new RegExp(Prototype.ScriptFragment,"img"),"")},extractScripts:function(){var a=new RegExp(Prototype.ScriptFragment,"img"),b=new RegExp(Prototype.ScriptFragment,"im");return(this.match(a)||[]).map(function(a){return(a.match(b)||["",""])[1]})},evalScripts:function(){return this.extractScripts().map(function(script){return eval(script)})},escapeHTML:function(){var a=document.createElement("div"),b=document.createTextNode(this);return a.appendChild(b),a.innerHTML},unescapeHTML:function(){var a=document.createElement("div");return a.innerHTML=this.stripTags(),a.childNodes[0]?a.childNodes.length>1?$A(a.childNodes).inject("",function(a,b){return a+b.nodeValue}):a.childNodes[0].nodeValue:""},toQueryParams:function(a){var b=this.strip().match(/([^?#]*)(#.*)?$/);return b?b[1].split(a||"&").inject({},function(a,b){if((b=b.split("="))[0]){var c=decodeURIComponent(b[0]),d=b[1]?decodeURIComponent(b[1]):undefined;a[c]!==undefined?(a[c].constructor!=Array&&(a[c]=[a[c]]),d&&a[c].push(d)):a[c]=d}return a}):{}},toArray:function(){return this.split("")},succ:function(){return this.slice(0,this.length-1)+String.fromCharCode(this.charCodeAt(this.length-1)+1)},camelize:function(){var a=this.split("-"),b=a.length;if(b==1)return a[0];var c=this.charAt(0)=="-"?a[0].charAt(0).toUpperCase()+a[0].substring(1):a[0];for(var d=1;d<b;d++)c+=a[d].charAt(0).toUpperCase()+a[d].substring(1);return c},capitalize:function(){return this.charAt(0).toUpperCase()+this.substring(1).toLowerCase()},underscore:function(){return this.gsub(/::/,"/").gsub(/([A-Z]+)([A-Z][a-z])/,"#{1}_#{2}").gsub(/([a-z\d])([A-Z])/,"#{1}_#{2}").gsub(/-/,"_").toLowerCase()},dasherize:function(){return this.gsub(/_/,"-")},inspect:function(a){var b=this.replace(/\\/g,"\\\\");return a?'"'+b.replace(/"/g,'\\"')+'"':"'"+b.replace(/'/g,"\\'")+"'"}}),String.prototype.gsub.prepareReplacement=function(a){if(typeof a=="function")return a;var b=new Template(a);return function(a){return b.evaluate(a)}},String.prototype.parseQuery=String.prototype.toQueryParams;var Template=Class.create();Template.Pattern=/(^|.|\r|\n)(#\{(.*?)\})/,Template.prototype={initialize:function(a,b){this.template=a.toString(),this.pattern=b||Template.Pattern},evaluate:function(a){return this.template.gsub(this.pattern,function(b){var c=b[1];return c=="\\"?b[2]:c+String.interpret(a[b[3]])})}};var $break=new Object,$continue=new Object,Enumerable={each:function(a){var b=0;try{this._each(function(c){try{a(c,b++)}catch(d){if(d!=$continue)throw d}})}catch(c){if(c!=$break)throw c}return this},eachSlice:function(a,b){var c=-a,d=[],e=this.toArray();while((c+=a)<e.length)d.push(e.slice(c,c+a));return d.map(b)},all:function(a){var b=!0;return this.each(function(c,d){b=b&&!!(a||Prototype.K)(c,d);if(!b)throw $break}),b},any:function(a){var b=!1;return this.each(function(c,d){if(b=!!(a||Prototype.K)(c,d))throw $break}),b},collect:function(a){var b=[];return this.each(function(c,d){b.push((a||Prototype.K)(c,d))}),b},detect:function(a){var b;return this.each(function(c,d){if(a(c,d))throw b=c,$break}),b},findAll:function(a){var b=[];return this.each(function(c,d){a(c,d)&&b.push(c)}),b},grep:function(a,b){var c=[];return this.each(function(d,e){var f=d.toString();f.match(a)&&c.push((b||Prototype.K)(d,e))}),c},include:function(a){var b=!1;return this.each(function(c){if(c==a)throw b=!0,$break}),b},inGroupsOf:function(a,b){return b=b===undefined?null:b,this.eachSlice(a,function(c){while(c.length<a)c.push(b);return c})},inject:function(a,b){return this.each(function(c,d){a=b(a,c,d)}),a},invoke:function(a){var b=$A(arguments).slice(1);return this.map(function(c){return c[a].apply(c,b)})},max:function(a){var b;return this.each(function(c,d){c=(a||Prototype.K)(c,d);if(b==undefined||c>=b)b=c}),b},min:function(a){var b;return this.each(function(c,d){c=(a||Prototype.K)(c,d);if(b==undefined||c<b)b=c}),b},partition:function(a){var b=[],c=[];return this.each(function(d,e){((a||Prototype.K)(d,e)?b:c).push(d)}),[b,c]},pluck:function(a){var b=[];return this.each(function(c,d){b.push(c[a])}),b},reject:function(a){var b=[];return this.each(function(c,d){a(c,d)||b.push(c)}),b},sortBy:function(a){return this.map(function(b,c){return{value:b,criteria:a(b,c)}}).sort(function(a,b){var c=a.criteria,d=b.criteria;return c<d?-1:c>d?1:0}).pluck("value")},toArray:function(){return this.map()},zip:function(){var a=Prototype.K,b=$A(arguments);typeof b.last()=="function"&&(a=b.pop());var c=[this].concat(b).map($A);return this.map(function(b,d){return a(c.pluck(d))})},size:function(){return this.toArray().length},inspect:function(){return"#<Enumerable:"+this.toArray().inspect()+">"}};Object.extend(Enumerable,{map:Enumerable.collect,find:Enumerable.detect,select:Enumerable.findAll,member:Enumerable.include,entries:Enumerable.toArray});var $A=Array.from=function(a){if(!a)return[];if(a.toArray)return a.toArray();var b=[];for(var c=0,d=a.length;c<d;c++)b.push(a[c]);return b};Object.extend(Array.prototype,Enumerable),Array.prototype._reverse||(Array.prototype._reverse=Array.prototype.reverse),Object.extend(Array.prototype,{_each:function(a){for(var b=0,c=this.length;b<c;b++)a(this[b])},clear:function(){return this.length=0,this},first:function(){return this[0]},last:function(){return this[this.length-1]},compact:function(){return this.select(function(a){return a!=null})},flatten:function(){return this.inject([],function(a,b){return a.concat(b&&b.constructor==Array?b.flatten():[b])})},without:function(){var a=$A(arguments);return this.select(function(b){return!a.include(b)})},indexOf:function(a){for(var b=0,c=this.length;b<c;b++)if(this[b]==a)return b;return-1},reverse:function(a){return(a!==!1?this:this.toArray())._reverse()},reduce:function(){return this.length>1?this:this[0]},uniq:function(){return this.inject([],function(a,b){return a.include(b)?a:a.concat([b])})},clone:function(){return[].concat(this)},size:function(){return this.length},inspect:function(){return"["+this.map(Object.inspect).join(", ")+"]"}}),Array.prototype.toArray=Array.prototype.clone,window.opera&&(Array.prototype.concat=function(){var a=[];for(var b=0,c=this.length;b<c;b++)a.push(this[b]);for(var b=0,c=arguments.length;b<c;b++)if(arguments[b].constructor==Array)for(var d=0,e=arguments[b].length;d<e;d++)a.push(arguments[b][d]);else a.push(arguments[b]);return a});var Hash=function(a){Object.extend(this,a||{})};Object.extend(Hash,{toQueryString:function(a){var b=[];return this.prototype._each.call(a,function(a){if(!a.key)return;if(a.value&&a.value.constructor==Array){var c=a.value.compact();if(!(c.length<2)){key=encodeURIComponent(a.key),c.each(function(a){a=a!=undefined?encodeURIComponent(a):"",b.push(key+"="+encodeURIComponent(a))});return}a.value=c.reduce()}a.value==undefined&&(a[1]=""),b.push(a.map(encodeURIComponent).join("="))}),b.join("&")}}),Object.extend(Hash.prototype,Enumerable),Object.extend(Hash.prototype,{_each:function(a){for(var b in this){var c=this[b];if(c&&c==Hash.prototype[b])continue;var d=[b,c];d.key=b,d.value=c,a(d)}},keys:function(){return this.pluck("key")},values:function(){return this.pluck("value")},merge:function(a){return $H(a).inject(this,function(a,b){return a[b.key]=b.value,a})},remove:function(){var a;for(var b=0,c=arguments.length;b<c;b++){var d=this[arguments[b]];d!==undefined&&(a===undefined?a=d:(a.constructor!=Array&&(a=[a]),a.push(d))),delete this[arguments[b]]}return a},toQueryString:function(){return Hash.toQueryString(this)},inspect:function(){return"#<Hash:{"+this.map(function(a){return a.map(Object.inspect).join(": ")}).join(", ")+"}>"}}),ObjectRange=Class.create(),Object.extend(ObjectRange.prototype,Enumerable),Object.extend(ObjectRange.prototype,{initialize:function(a,b,c){this.start=a,this.end=b,this.exclusive=c},_each:function(a){var b=this.start;while(this.include(b))a(b),b=b.succ()},include:function(a){return a<this.start?!1:this.exclusive?a<this.end:a<=this.end}});var $R=function(a,b,c){return new ObjectRange(a,b,c)},Ajax={getTransport:function(){return Try.these(function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")})||!1},activeRequestCount:0};Ajax.Responders={responders:[],_each:function(a){this.responders._each(a)},register:function(a){this.include(a)||this.responders.push(a)},unregister:function(a){this.responders=this.responders.without(a)},dispatch:function(a,b,c,d){this.each(function(e){if(typeof e[a]=="function")try{e[a].apply(e,[b,c,d])}catch(f){}})}},Object.extend(Ajax.Responders,Enumerable),Ajax.Responders.register({onCreate:function(){Ajax.activeRequestCount++},onComplete:function(){Ajax.activeRequestCount--}}),Ajax.Base=function(){},Ajax.Base.prototype={setOptions:function(a){this.options={method:"post",asynchronous:!0,contentType:"application/x-www-form-urlencoded",encoding:"UTF-8",parameters:""},Object.extend(this.options,a||{}),this.options.method=this.options.method.toLowerCase(),typeof this.options.parameters=="string"&&(this.options.parameters=this.options.parameters.toQueryParams())}},Ajax.Request=Class.create(),Ajax.Request.Events=["Uninitialized","Loading","Loaded","Interactive","Complete"],Ajax.Request.prototype=Object.extend(new Ajax.Base,{_complete:!1,initialize:function(a,b){this.transport=Ajax.getTransport(),this.setOptions(b),this.request(a)},request:function(a){this.url=a,this.method=this.options.method;var b=this.options.parameters;["get","post"].include(this.method)||(b._method=this.method,this.method="post"),b=Hash.toQueryString(b),b&&/Konqueror|Safari|KHTML/.test(navigator.userAgent)&&(b+="&_="),this.method=="get"&&b&&(this.url+=(this.url.indexOf("?")>-1?"&":"?")+b);try{Ajax.Responders.dispatch("onCreate",this,this.transport),this.transport.open(this.method.toUpperCase(),this.url,this.options.asynchronous),this.options.asynchronous&&setTimeout(function(){this.respondToReadyState(1)}.bind(this),10),this.transport.onreadystatechange=this.onStateChange.bind(this),this.setRequestHeaders();var c=this.method=="post"?this.options.postBody||b:null;this.transport.send(c),!this.options.asynchronous&&this.transport.overrideMimeType&&this.onStateChange()}catch(d){this.dispatchException(d)}},onStateChange:function(){var a=this.transport.readyState;a>1&&(a!=4||!this._complete)&&this.respondToReadyState(this.transport.readyState)},setRequestHeaders:function(){var a={"X-Requested-With":"XMLHttpRequest","X-Prototype-Version":Prototype.Version,Accept:"text/javascript, text/html, application/xml, text/xml, */*"};this.method=="post"&&(a["Content-type"]=this.options.contentType+(this.options.encoding?"; charset="+this.options.encoding:""),this.transport.overrideMimeType&&(navigator.userAgent.match(/Gecko\/(\d{4})/)||[0,2005])[1]<2005&&(a.Connection="close"));if(typeof this.options.requestHeaders=="object"){var b=this.options.requestHeaders;if(typeof b.push=="function")for(var c=0,d=b.length;c<d;c+=2)a[b[c]]=b[c+1];else $H(b).each(function(b){a[b.key]=b.value})}for(var e in a)this.transport.setRequestHeader(e,a[e])},success:function(){return!this.transport.status||this.transport.status>=200&&this.transport.status<300},respondToReadyState:function(a){var b=Ajax.Request.Events[a],c=this.transport,d=this.evalJSON();if(b=="Complete"){try{this._complete=!0,(this.options["on"+this.transport.status]||this.options["on"+(this.success()?"Success":"Failure")]||Prototype.emptyFunction)(c,d)}catch(e){this.dispatchException(e)}(this.getHeader("Content-type")||"text/javascript").strip().match(/^(text|application)\/(x-)?(java|ecma)script(;.*)?$/i)&&this.evalResponse()}try{(this.options["on"+b]||Prototype.emptyFunction)(c,d),Ajax.Responders.dispatch("on"+b,this,c,d)}catch(e){this.dispatchException(e)}b=="Complete"&&(this.transport.onreadystatechange=Prototype.emptyFunction)},getHeader:function(a){try{return this.transport.getResponseHeader(a)}catch(b){return null}},evalJSON:function(){try{var json=this.getHeader("X-JSON");return json?eval("("+json+")"):null}catch(e){return null}},evalResponse:function(){try{return eval(this.transport.responseText)}catch(e){this.dispatchException(e)}},dispatchException:function(a){(this.options.onException||Prototype.emptyFunction)(this,a),Ajax.Responders.dispatch("onException",this,a)}}),Ajax.Updater=Class.create(),Object.extend(Object.extend(Ajax.Updater.prototype,Ajax.Request.prototype),{initialize:function(a,b,c){this.container={success:a.success||a,failure:a.failure||(a.success?null:a)},this.transport=Ajax.getTransport(),this.setOptions(c);var d=this.options.onComplete||Prototype.emptyFunction;this.options.onComplete=function(a,b){this.updateContent(),d(a,b)}.bind(this),this.request(b)},updateContent:function(){var a=this.container[this.success()?"success":"failure"],b=this.transport.responseText;this.options.evalScripts||(b=b.stripScripts());if(a=$(a))this.options.insertion?new this.options.insertion(a,b):a.update(b);this.success()&&this.onComplete&&setTimeout(this.onComplete.bind(this),10)}}),Ajax.PeriodicalUpdater=Class.create(),Ajax.PeriodicalUpdater.prototype=Object.extend(new Ajax.Base,{initialize:function(a,b,c){this.setOptions(c),this.onComplete=this.options.onComplete,this.frequency=this.options.frequency||2,this.decay=this.options.decay||1,this.updater={},this.container=a,this.url=b,this.start()},start:function(){this.options.onComplete=this.updateComplete.bind(this),this.onTimerEvent()},stop:function(){this.updater.options.onComplete=undefined,clearTimeout(this.timer),(this.onComplete||Prototype.emptyFunction).apply(this,arguments)},updateComplete:function(a){this.options.decay&&(this.decay=a.responseText==this.lastText?this.decay*this.options.decay:1,this.lastText=a.responseText),this.timer=setTimeout(this.onTimerEvent.bind(this),this.decay*this.frequency*1e3)},onTimerEvent:function(){this.updater=new Ajax.Updater(this.container,this.url,this.options)}}),Prototype.BrowserFeatures.XPath&&(document._getElementsByXPath=function(a,b){var c=[],d=document.evaluate(a,$(b)||document,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null);for(var e=0,f=d.snapshotLength;e<f;e++)c.push(d.snapshotItem(e));return c}),document.getElementsByClassName=function(a,b){if(Prototype.BrowserFeatures.XPath){var c=".//*[contains(concat(' ', @class, ' '), ' "+a+" ')]";return document._getElementsByXPath(c,b)}var d=($(b)||document.body).getElementsByTagName("*"),e=[],f;for(var g=0,h=d.length;g<h;g++)f=d[g],Element.hasClassName(f,a)&&e.push(Element.extend(f));return e};if(!window.Element)var Element=new Object;Element.extend=function(a){if(!a||_nativeExtensions||a.nodeType==3)return a;if(!a._extended&&a.tagName&&a!=window){var b=Object.clone(Element.Methods),c=Element.extend.cache;a.tagName=="FORM"&&Object.extend(b,Form.Methods),["INPUT","TEXTAREA","SELECT"].include(a.tagName)&&Object.extend(b,Form.Element.Methods),Object.extend(b,Element.Methods.Simulated);for(var d in b){var e=b[d];typeof e=="function"&&!(d in a)&&(a[d]=c.findOrStore(e))}}return a._extended=!0,a},Element.extend.cache={findOrStore:function(a){return this[a]=this[a]||function(){return a.apply(null,[this].concat($A(arguments)))}}},Element.Methods={visible:function(a){return $(a).style.display!="none"},toggle:function(a){return a=$(a),Element[Element.visible(a)?"hide":"show"](a),a},hide:function(a){return $(a).style.display="none",a},show:function(a){return $(a).style.display="",a},remove:function(a){return a=$(a),a.parentNode.removeChild(a),a},update:function(a,b){return b=typeof b=="undefined"?"":b.toString(),$(a).innerHTML=b.stripScripts(),setTimeout(function(){b.evalScripts()},10),a},replace:function(a,b){a=$(a),b=typeof b=="undefined"?"":b.toString();if(a.outerHTML)a.outerHTML=b.stripScripts();else{var c=a.ownerDocument.createRange();c.selectNodeContents(a),a.parentNode.replaceChild(c.createContextualFragment(b.stripScripts()),a)}return setTimeout(function(){b.evalScripts()},10),a},inspect:function(a){a=$(a);var b="<"+a.tagName.toLowerCase();return $H({id:"id",className:"class"}).each(function(c){var d=c.first(),e=c.last(),f=(a[d]||"").toString();f&&(b+=" "+e+"="+f.inspect(!0))}),b+">"},recursivelyCollect:function(a,b){a=$(a);var c=[];while(a=a[b])a.nodeType==1&&c.push(Element.extend(a));return c},ancestors:function(a){return $(a).recursivelyCollect("parentNode")},descendants:function(a){return $A($(a).getElementsByTagName("*"))},immediateDescendants:function(a){if(!(a=$(a).firstChild))return[];while(a&&a.nodeType!=1)a=a.nextSibling;return a?[a].concat($(a).nextSiblings()):[]},previousSiblings:function(a){return $(a).recursivelyCollect("previousSibling")},nextSiblings:function(a){return $(a).recursivelyCollect("nextSibling")},siblings:function(a){return a=$(a),a.previousSiblings().reverse().concat(a.nextSiblings())},match:function(a,b){return typeof b=="string"&&(b=new Selector(b)),b.match($(a))},up:function(a,b,c){return Selector.findElement($(a).ancestors(),b,c)},down:function(a,b,c){return Selector.findElement($(a).descendants(),b,c)},previous:function(a,b,c){return Selector.findElement($(a).previousSiblings(),b,c)},next:function(a,b,c){return Selector.findElement($(a).nextSiblings(),b,c)},getElementsBySelector:function(){var a=$A(arguments),b=$(a.shift());return Selector.findChildElements(b,a)},getElementsByClassName:function(a,b){return document.getElementsByClassName(b,a)},readAttribute:function(a,b){a=$(a);if(document.all&&!window.opera){var c=Element._attributeTranslations;if(c.values[b])return c.values[b](a,b);c.names[b]&&(b=c.names[b]);var d=a.attributes[b];if(d)return d.nodeValue}return a.getAttribute(b)},getHeight:function(a){return $(a).getDimensions().height},getWidth:function(a){return $(a).getDimensions().width},classNames:function(a){return new Element.ClassNames(a)},hasClassName:function(a,b){if(!(a=$(a)))return;var c=a.className;return c.length==0?!1:c==b||c.match(new RegExp("(^|\\s)"+b+"(\\s|$)"))?!0:!1},addClassName:function(a,b){if(!(a=$(a)))return;return Element.classNames(a).add(b),a},removeClassName:function(a,b){if(!(a=$(a)))return;return Element.classNames(a).remove(b),a},toggleClassName:function(a,b){if(!(a=$(a)))return;return Element.classNames(a)[a.hasClassName(b)?"remove":"add"](b),a},observe:function(){return Event.observe.apply(Event,arguments),$A(arguments).first()},stopObserving:function(){return Event.stopObserving.apply(Event,arguments),$A(arguments).first()},cleanWhitespace:function(a){a=$(a);var b=a.firstChild;while(b){var c=b.nextSibling;b.nodeType==3&&!/\S/.test(b.nodeValue)&&a.removeChild(b),b=c}return a},empty:function(a){return $(a).innerHTML.match(/^\s*$/)},descendantOf:function(a,b){a=$(a),b=$(b);while(a=a.parentNode)if(a==b)return!0;return!1},scrollTo:function(a){a=$(a);var b=Position.cumulativeOffset(a);return window.scrollTo(b[0],b[1]),a},getStyle:function(a,b){a=$(a),["float","cssFloat"].include(b)&&(b=typeof a.style.styleFloat!="undefined"?"styleFloat":"cssFloat"),b=b.camelize();var c=a.style[b];if(!c)if(document.defaultView&&document.defaultView.getComputedStyle){var d=document.defaultView.getComputedStyle(a,null);c=d?d[b]:null}else a.currentStyle&&(c=a.currentStyle[b]);c=="auto"&&["width","height"].include(b)&&a.getStyle("display")!="none"&&(c=a["offset"+b.capitalize()]+"px"),window.opera&&["left","top","right","bottom"].include(b)&&Element.getStyle(a,"position")=="static"&&(c="auto");if(b=="opacity"){if(c)return parseFloat(c);if(c=(a.getStyle("filter")||"").match(/alpha\(opacity=(.*)\)/))if(c[1])return parseFloat(c[1])/100;return 1}return c=="auto"?null:c},setStyle:function(a,b){a=$(a);for(var c in b){var d=b[c];c=="opacity"?d==1?(d=/Gecko/.test(navigator.userAgent)&&!/Konqueror|Safari|KHTML/.test(navigator.userAgent)?.999999:1,/MSIE/.test(navigator.userAgent)&&!window.opera&&(a.style.filter=a.getStyle("filter").replace(/alpha\([^\)]*\)/gi,""))):d==""?/MSIE/.test(navigator.userAgent)&&!window.opera&&(a.style.filter=a.getStyle("filter").replace(/alpha\([^\)]*\)/gi,"")):(d<1e-5&&(d=0),/MSIE/.test(navigator.userAgent)&&!window.opera&&(a.style.filter=a.getStyle("filter").replace(/alpha\([^\)]*\)/gi,"")+"alpha(opacity="+d*100+")")):["float","cssFloat"].include(c)&&(c=typeof a.style.styleFloat!="undefined"?"styleFloat":"cssFloat"),a.style[c.camelize()]=d}return a},getDimensions:function(a){a=$(a);var b=$(a).getStyle("display");if(b!="none"&&b!=null)return{width:a.offsetWidth,height:a.offsetHeight};var c=a.style,d=c.visibility,e=c.position,f=c.display;c.visibility="hidden",c.position="absolute",c.display="block";var g=a.clientWidth,h=a.clientHeight;return c.display=f,c.position=e,c.visibility=d,{width:g,height:h}},makePositioned:function(a){a=$(a);var b=Element.getStyle(a,"position");if(b=="static"||!b)a._madePositioned=!0,a.style.position="relative",window.opera&&(a.style.top=0,a.style.left=0);return a},undoPositioned:function(a){return a=$(a),a._madePositioned&&(a._madePositioned=undefined,a.style.position=a.style.top=a.style.left=a.style.bottom=a.style.right=""),a},makeClipping:function(a){return a=$(a),a._overflow?a:(a._overflow=a.style.overflow||"auto",(Element.getStyle(a,"overflow")||"visible")!="hidden"&&(a.style.overflow="hidden"),a)},undoClipping:function(a){return a=$(a),a._overflow?(a.style.overflow=a._overflow=="auto"?"":a._overflow,a._overflow=null,a):a}},Object.extend(Element.Methods,{childOf:Element.Methods.descendantOf}),Element._attributeTranslations={},Element._attributeTranslations.names={colspan:"colSpan",rowspan:"rowSpan",valign:"vAlign",datetime:"dateTime",accesskey:"accessKey",tabindex:"tabIndex",enctype:"encType",maxlength:"maxLength",readonly:"readOnly",longdesc:"longDesc"},Element._attributeTranslations.values={_getAttr:function(a,b){return a.getAttribute(b,2)},_flag:function(a,b){return $(a).hasAttribute(b)?b:null},style:function(a){return a.style.cssText.toLowerCase()},title:function(a){var b=a.getAttributeNode("title");return b.specified?b.nodeValue:null}},Object.extend(Element._attributeTranslations.values,{href:Element._attributeTranslations.values._getAttr,src:Element._attributeTranslations.values._getAttr,disabled:Element._attributeTranslations.values._flag,checked:Element._attributeTranslations.values._flag,readonly:Element._attributeTranslations.values._flag,multiple:Element._attributeTranslations.values._flag}),Element.Methods.Simulated={hasAttribute:function(a,b){var c=Element._attributeTranslations;return b=c.names[b]||b,$(a).getAttributeNode(b).specified}},document.all&&!window.opera&&(Element.Methods.update=function(a,b){a=$(a),b=typeof b=="undefined"?"":b.toString();var c=a.tagName.toUpperCase();if(["THEAD","TBODY","TR","TD"].include(c)){var d=document.createElement("div");switch(c){case"THEAD":case"TBODY":d.innerHTML="<table><tbody>"+b.stripScripts()+"</tbody></table>",depth=2;break;case"TR":d.innerHTML="<table><tbody><tr>"+b.stripScripts()+"</tr></tbody></table>",depth=3;break;case"TD":d.innerHTML="<table><tbody><tr><td>"+b.stripScripts()+"</td></tr></tbody></table>",depth=4}$A(a.childNodes).each(function(b){a.removeChild(b)}),depth.times(function(){d=d.firstChild}),$A(d.childNodes).each(function(b){a.appendChild(b)})}else a.innerHTML=b.stripScripts();return setTimeout(function(){b.evalScripts()},10),a}),Object.extend(Element,Element.Methods);var _nativeExtensions=!1;/Konqueror|Safari|KHTML/.test(navigator.userAgent)&&["","Form","Input","TextArea","Select"].each(function(a){var b="HTML"+a+"Element";if(window[b])return;var c=window[b]={};c.prototype=document.createElement(a?a.toLowerCase():"div").__proto__}),Element.addMethods=function(a){function b(a,b,c){c=c||!1;var d=Element.extend.cache;for(var e in a){var f=a[e];if(!c||!(e in b))b[e]=d.findOrStore(f)}}Object.extend(Element.Methods,a||{}),typeof HTMLElement!="undefined"&&(b(Element.Methods,HTMLElement.prototype),b(Element.Methods.Simulated,HTMLElement.prototype,!0),b(Form.Methods,HTMLFormElement.prototype),[HTMLInputElement,HTMLTextAreaElement,HTMLSelectElement].each(function(a){b(Form.Element.Methods,a.prototype)}),_nativeExtensions=!0)};var Toggle=new Object;Toggle.display=Element.toggle,Abstract.Insertion=function(a){this.adjacency=a},Abstract.Insertion.prototype={initialize:function(a,b){this.element=$(a),this.content=b.stripScripts();if(this.adjacency&&this.element.insertAdjacentHTML)try{this.element.insertAdjacentHTML(this.adjacency,this.content)}catch(c){var d=this.element.tagName.toUpperCase();if(!["TBODY","TR"].include(d))throw c;this.insertContent(this.contentFromAnonymousTable())}else this.range=this.element.ownerDocument.createRange(),this.initializeRange&&this.initializeRange(),this.insertContent([this.range.createContextualFragment(this.content)]);setTimeout(function(){b.evalScripts()},10)},contentFromAnonymousTable:function(){var a=document.createElement("div");return a.innerHTML="<table><tbody>"+this.content+"</tbody></table>",$A(a.childNodes[0].childNodes[0].childNodes)}};var Insertion=new Object;Insertion.Before=Class.create(),Insertion.Before.prototype=Object.extend(new Abstract.Insertion("beforeBegin"),{initializeRange:function(){this.range.setStartBefore(this.element)},insertContent:function(a){a.each(function(a){this.element.parentNode.insertBefore(a,this.element)}.bind(this))}}),Insertion.Top=Class.create(),Insertion.Top.prototype=Object.extend(new Abstract.Insertion("afterBegin"),{initializeRange:function(){this.range.selectNodeContents(this.element),this.range.collapse(!0)},insertContent:function(a){a.reverse(!1).each(function(a){this.element.insertBefore(a,this.element.firstChild)}.bind(this))}}),Insertion.Bottom=Class.create(),Insertion.Bottom.prototype=Object.extend(new Abstract.Insertion("beforeEnd"),{initializeRange:function(){this.range.selectNodeContents(this.element),this.range.collapse(this.element)},insertContent:function(a){a.each(function(a){this.element.appendChild(a)}.bind(this))}}),Insertion.After=Class.create(),Insertion.After.prototype=Object.extend(new Abstract.Insertion("afterEnd"),{initializeRange:function(){this.range.setStartAfter(this.element)},insertContent:function(a){a.each(function(a){this.element.parentNode.insertBefore(a,this.element.nextSibling)}.bind(this))}}),Element.ClassNames=Class.create(),Element.ClassNames.prototype={initialize:function(a){this.element=$(a)},_each:function(a){this.element.className.split(/\s+/).select(function(a){return a.length>0})._each(a)},set:function(a){this.element.className=a},add:function(a){if(this.include(a))return;this.set($A(this).concat(a).join(" "))},remove:function(a){if(!this.include(a))return;this.set($A(this).without(a).join(" "))},toString:function(){return $A(this).join(" ")}},Object.extend(Element.ClassNames.prototype,Enumerable);var Selector=Class.create();Selector.prototype={initialize:function(a){this.params={classNames:[]},this.expression=a.toString().strip(),this.parseExpression(),this.compileMatcher()},parseExpression:function(){function a(a){throw"Parse error in selector: "+a}this.expression==""&&a("empty expression");var b=this.params,c=this.expression,d,e,f,g;while(d=c.match(/^(.*)\[([a-z0-9_:-]+?)(?:([~\|!]?=)(?:"([^"]*)"|([^\]\s]*)))?\]$/i))b.attributes=b.attributes||[],b.attributes.push({name:d[2],operator:d[3],value:d[4]||d[5]||""}),c=d[1];if(c=="*")return this.params.wildcard=!0;while(d=c.match(/^([^a-z0-9_-])?([a-z0-9_-]+)(.*)/i)){e=d[1],f=d[2],g=d[3];switch(e){case"#":b.id=f;break;case".":b.classNames.push(f);break;case"":case undefined:b.tagName=f.toUpperCase();break;default:a(c.inspect())}c=g}c.length>0&&a(c.inspect())},buildMatchExpression:function(){var a=this.params,b=[],c;a.wildcard&&b.push("true"),(c=a.id)&&b.push('element.readAttribute("id") == '+c.inspect()),(c=a.tagName)&&b.push("element.tagName.toUpperCase() == "+c.inspect());if((c=a.classNames).length>0)for(var d=0,e=c.length;d<e;d++)b.push("element.hasClassName("+c[d].inspect()+")");return(c=a.attributes)&&c.each(function(a){var c="element.readAttribute("+a.name.inspect()+")",d=function(a){return c+" && "+c+".split("+a.inspect()+")"};switch(a.operator){case"=":b.push(c+" == "+a.value.inspect());break;case"~=":b.push(d(" ")+".include("+a.value.inspect()+")");break;case"|=":b.push(d("-")+".first().toUpperCase() == "+a.value.toUpperCase().inspect());break;case"!=":b.push(c+" != "+a.value.inspect());break;case"":case undefined:b.push("element.hasAttribute("+a.name.inspect()+")");break;default:throw"Unknown operator "+a.operator+" in selector"}}),b.join(" && ")},compileMatcher:function(){this.match=new Function("element","if (!element.tagName) return false;       element = $(element);       return "+this.buildMatchExpression())},findElements:function(a){var b;if(b=$(this.params.id))if(this.match(b))if(!a||Element.childOf(b,a))return[b];a=(a||document).getElementsByTagName(this.params.tagName||"*");var c=[];for(var d=0,e=a.length;d<e;d++)this.match(b=a[d])&&c.push(Element.extend(b));return c},toString:function(){return this.expression}},Object.extend(Selector,{matchElements:function(a,b){var c=new Selector(b);return a.select(c.match.bind(c)).map(Element.extend)},findElement:function(a,b,c){return typeof b=="number"&&(c=b,b=!1),Selector.matchElements(a,b||"*")[c||0]},findChildElements:function(a,b){return b.map(function(b){return b.match(/[^\s"]+(?:"[^"]*"[^\s"]+)*/g).inject([null],function(b,c){var d=new Selector(c);return b.inject([],function(b,c){return b.concat(d.findElements(c||a))})})}).flatten()}});var Form={reset:function(a){return $(a).reset(),a},serializeElements:function(a,b){var c=a.inject({},function(a,b){if(!b.disabled&&b.name){var c=b.name,d=$(b).getValue();d!=undefined&&(a[c]?(a[c].constructor!=Array&&(a[c]=[a[c]]),a[c].push(d
)):a[c]=d)}return a});return b?c:Hash.toQueryString(c)}};Form.Methods={serialize:function(a,b){return Form.serializeElements(Form.getElements(a),b)},getElements:function(a){return $A($(a).getElementsByTagName("*")).inject([],function(a,b){return Form.Element.Serializers[b.tagName.toLowerCase()]&&a.push(Element.extend(b)),a})},getInputs:function(a,b,c){a=$(a);var d=a.getElementsByTagName("input");if(!b&&!c)return $A(d).map(Element.extend);for(var e=0,f=[],g=d.length;e<g;e++){var h=d[e];if(b&&h.type!=b||c&&h.name!=c)continue;f.push(Element.extend(h))}return f},disable:function(a){return a=$(a),a.getElements().each(function(a){a.blur(),a.disabled="true"}),a},enable:function(a){return a=$(a),a.getElements().each(function(a){a.disabled=""}),a},findFirstElement:function(a){return $(a).getElements().find(function(a){return a.type!="hidden"&&!a.disabled&&["input","select","textarea"].include(a.tagName.toLowerCase())})},focusFirstElement:function(a){return a=$(a),a.findFirstElement().activate(),a}},Object.extend(Form,Form.Methods),Form.Element={focus:function(a){return $(a).focus(),a},select:function(a){return $(a).select(),a}},Form.Element.Methods={serialize:function(a){a=$(a);if(!a.disabled&&a.name){var b=a.getValue();if(b!=undefined){var c={};return c[a.name]=b,Hash.toQueryString(c)}}return""},getValue:function(a){a=$(a);var b=a.tagName.toLowerCase();return Form.Element.Serializers[b](a)},clear:function(a){return $(a).value="",a},present:function(a){return $(a).value!=""},activate:function(a){return a=$(a),a.focus(),a.select&&(a.tagName.toLowerCase()!="input"||!["button","reset","submit"].include(a.type))&&a.select(),a},disable:function(a){return a=$(a),a.disabled=!0,a},enable:function(a){return a=$(a),a.blur(),a.disabled=!1,a}},Object.extend(Form.Element,Form.Element.Methods);var Field=Form.Element,$F=Form.Element.getValue;Form.Element.Serializers={input:function(a){switch(a.type.toLowerCase()){case"checkbox":case"radio":return Form.Element.Serializers.inputSelector(a);default:return Form.Element.Serializers.textarea(a)}},inputSelector:function(a){return a.checked?a.value:null},textarea:function(a){return a.value},select:function(a){return this[a.type=="select-one"?"selectOne":"selectMany"](a)},selectOne:function(a){var b=a.selectedIndex;return b>=0?this.optionValue(a.options[b]):null},selectMany:function(a){var b,c=a.length;if(!c)return null;for(var d=0,b=[];d<c;d++){var e=a.options[d];e.selected&&b.push(this.optionValue(e))}return b},optionValue:function(a){return Element.extend(a).hasAttribute("value")?a.value:a.text}},Abstract.TimedObserver=function(){},Abstract.TimedObserver.prototype={initialize:function(a,b,c){this.frequency=b,this.element=$(a),this.callback=c,this.lastValue=this.getValue(),this.registerCallback()},registerCallback:function(){setInterval(this.onTimerEvent.bind(this),this.frequency*1e3)},onTimerEvent:function(){var a=this.getValue(),b="string"==typeof this.lastValue&&"string"==typeof a?this.lastValue!=a:String(this.lastValue)!=String(a);b&&(this.callback(this.element,a),this.lastValue=a)}},Form.Element.Observer=Class.create(),Form.Element.Observer.prototype=Object.extend(new Abstract.TimedObserver,{getValue:function(){return Form.Element.getValue(this.element)}}),Form.Observer=Class.create(),Form.Observer.prototype=Object.extend(new Abstract.TimedObserver,{getValue:function(){return Form.serialize(this.element)}}),Abstract.EventObserver=function(){},Abstract.EventObserver.prototype={initialize:function(a,b){this.element=$(a),this.callback=b,this.lastValue=this.getValue(),this.element.tagName.toLowerCase()=="form"?this.registerFormCallbacks():this.registerCallback(this.element)},onElementEvent:function(){var a=this.getValue();this.lastValue!=a&&(this.callback(this.element,a),this.lastValue=a)},registerFormCallbacks:function(){Form.getElements(this.element).each(this.registerCallback.bind(this))},registerCallback:function(a){if(a.type)switch(a.type.toLowerCase()){case"checkbox":case"radio":Event.observe(a,"click",this.onElementEvent.bind(this));break;default:Event.observe(a,"change",this.onElementEvent.bind(this))}}},Form.Element.EventObserver=Class.create(),Form.Element.EventObserver.prototype=Object.extend(new Abstract.EventObserver,{getValue:function(){return Form.Element.getValue(this.element)}}),Form.EventObserver=Class.create(),Form.EventObserver.prototype=Object.extend(new Abstract.EventObserver,{getValue:function(){return Form.serialize(this.element)}});if(!window.Event)var Event=new Object;Object.extend(Event,{KEY_BACKSPACE:8,KEY_TAB:9,KEY_RETURN:13,KEY_ESC:27,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,KEY_HOME:36,KEY_END:35,KEY_PAGEUP:33,KEY_PAGEDOWN:34,element:function(a){return a.target||a.srcElement},isLeftClick:function(a){return a.which&&a.which==1||a.button&&a.button==1},pointerX:function(a){return a.pageX||a.clientX+(document.documentElement.scrollLeft||document.body.scrollLeft)},pointerY:function(a){return a.pageY||a.clientY+(document.documentElement.scrollTop||document.body.scrollTop)},stop:function(a){a.preventDefault?(a.preventDefault(),a.stopPropagation()):(a.returnValue=!1,a.cancelBubble=!0)},findElement:function(a,b){var c=Event.element(a);while(c.parentNode&&(!c.tagName||c.tagName.toUpperCase()!=b.toUpperCase()))c=c.parentNode;return c},observers:!1,_observeAndCache:function(a,b,c,d){this.observers||(this.observers=[]),a.addEventListener?(this.observers.push([a,b,c,d]),a.addEventListener(b,c,d)):a.attachEvent&&(this.observers.push([a,b,c,d]),a.attachEvent("on"+b,c))},unloadCache:function(){if(!Event.observers)return;for(var a=0,b=Event.observers.length;a<b;a++)Event.stopObserving.apply(this,Event.observers[a]),Event.observers[a][0]=null;Event.observers=!1},observe:function(a,b,c,d){a=$(a),d=d||!1,b=="keypress"&&(navigator.appVersion.match(/Konqueror|Safari|KHTML/)||a.attachEvent)&&(b="keydown"),Event._observeAndCache(a,b,c,d)},stopObserving:function(a,b,c,d){a=$(a),d=d||!1,b=="keypress"&&(navigator.appVersion.match(/Konqueror|Safari|KHTML/)||a.detachEvent)&&(b="keydown");if(a.removeEventListener)a.removeEventListener(b,c,d);else if(a.detachEvent)try{a.detachEvent("on"+b,c)}catch(e){}}}),navigator.appVersion.match(/\bMSIE\b/)&&Event.observe(window,"unload",Event.unloadCache,!1);var Position={includeScrollOffsets:!1,prepare:function(){this.deltaX=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0,this.deltaY=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0},realOffset:function(a){var b=0,c=0;do b+=a.scrollTop||0,c+=a.scrollLeft||0,a=a.parentNode;while(a);return[c,b]},cumulativeOffset:function(a){var b=0,c=0;do b+=a.offsetTop||0,c+=a.offsetLeft||0,a=a.offsetParent;while(a);return[c,b]},positionedOffset:function(a){var b=0,c=0;do{b+=a.offsetTop||0,c+=a.offsetLeft||0,a=a.offsetParent;if(a){if(a.tagName=="BODY")break;var d=Element.getStyle(a,"position");if(d=="relative"||d=="absolute")break}}while(a);return[c,b]},offsetParent:function(a){if(a.offsetParent)return a.offsetParent;if(a==document.body)return a;while((a=a.parentNode)&&a!=document.body)if(Element.getStyle(a,"position")!="static")return a;return document.body},within:function(a,b,c){return this.includeScrollOffsets?this.withinIncludingScrolloffsets(a,b,c):(this.xcomp=b,this.ycomp=c,this.offset=this.cumulativeOffset(a),c>=this.offset[1]&&c<this.offset[1]+a.offsetHeight&&b>=this.offset[0]&&b<this.offset[0]+a.offsetWidth)},withinIncludingScrolloffsets:function(a,b,c){var d=this.realOffset(a);return this.xcomp=b+d[0]-this.deltaX,this.ycomp=c+d[1]-this.deltaY,this.offset=this.cumulativeOffset(a),this.ycomp>=this.offset[1]&&this.ycomp<this.offset[1]+a.offsetHeight&&this.xcomp>=this.offset[0]&&this.xcomp<this.offset[0]+a.offsetWidth},overlap:function(a,b){if(!a)return 0;if(a=="vertical")return(this.offset[1]+b.offsetHeight-this.ycomp)/b.offsetHeight;if(a=="horizontal")return(this.offset[0]+b.offsetWidth-this.xcomp)/b.offsetWidth},page:function(a){var b=0,c=0,d=a;do{b+=d.offsetTop||0,c+=d.offsetLeft||0;if(d.offsetParent==document.body&&Element.getStyle(d,"position")=="absolute")break}while(d=d.offsetParent);d=a;do if(!window.opera||d.tagName=="BODY")b-=d.scrollTop||0,c-=d.scrollLeft||0;while(d=d.parentNode);return[c,b]},clone:function(a,b){var c=Object.extend({setLeft:!0,setTop:!0,setWidth:!0,setHeight:!0,offsetTop:0,offsetLeft:0},arguments[2]||{});a=$(a);var d=Position.page(a);b=$(b);var e=[0,0],f=null;Element.getStyle(b,"position")=="absolute"&&(f=Position.offsetParent(b),e=Position.page(f)),f==document.body&&(e[0]-=document.body.offsetLeft,e[1]-=document.body.offsetTop),c.setLeft&&(b.style.left=d[0]-e[0]+c.offsetLeft+"px"),c.setTop&&(b.style.top=d[1]-e[1]+c.offsetTop+"px"),c.setWidth&&(b.style.width=a.offsetWidth+"px"),c.setHeight&&(b.style.height=a.offsetHeight+"px")},absolutize:function(a){a=$(a);if(a.style.position=="absolute")return;Position.prepare();var b=Position.positionedOffset(a),c=b[1],d=b[0],e=a.clientWidth,f=a.clientHeight;a._originalLeft=d-parseFloat(a.style.left||0),a._originalTop=c-parseFloat(a.style.top||0),a._originalWidth=a.style.width,a._originalHeight=a.style.height,a.style.position="absolute",a.style.top=c+"px",a.style.left=d+"px",a.style.width=e+"px",a.style.height=f+"px"},relativize:function(a){a=$(a);if(a.style.position=="relative")return;Position.prepare(),a.style.position="relative";var b=parseFloat(a.style.top||0)-(a._originalTop||0),c=parseFloat(a.style.left||0)-(a._originalLeft||0);a.style.top=b+"px",a.style.left=c+"px",a.style.height=a._originalHeight,a.style.width=a._originalWidth}};/Konqueror|Safari|KHTML/.test(navigator.userAgent)&&(Position.cumulativeOffset=function(a){var b=0,c=0;do{b+=a.offsetTop||0,c+=a.offsetLeft||0;if(a.offsetParent==document.body&&Element.getStyle(a,"position")=="absolute")break;a=a.offsetParent}while(a);return[c,b]}),Element.addMethods(),shortcut={all_shortcuts:{},add:function(a,b,c){var d={type:"keydown",propagate:!1,disable_in_input:!1,target:document,keycode:!1};if(!c)c=d;else for(var e in d)typeof c[e]=="undefined"&&(c[e]=d[e]);var f=c.target;typeof c.target=="string"&&(f=document.getElementById(c.target));var g=this;a=a.toLowerCase();var h=function(d){d=d||window.event;if(c.disable_in_input){var e;d.target?e=d.target:d.srcElement&&(e=d.srcElement),e.nodeType==3&&(e=e.parentNode);if(e.tagName=="INPUT"||e.tagName=="TEXTAREA")return}d.keyCode?code=d.keyCode:d.which&&(code=d.which);var f=String.fromCharCode(code).toLowerCase();code==188&&(f=","),code==190&&(f=".");var g=a.split("+"),h=0,i={"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")","-":"_","=":"+",";":":","'":'"',",":"<",".":">","/":"?","\\":"|"},j={esc:27,escape:27,tab:9,space:32,"return":13,enter:13,backspace:8,scrolllock:145,scroll_lock:145,scroll:145,capslock:20,caps_lock:20,caps:20,numlock:144,num_lock:144,num:144,pause:19,"break":19,insert:45,home:36,"delete":46,end:35,pageup:33,page_up:33,pu:33,pagedown:34,page_down:34,pd:34,left:37,up:38,right:39,down:40,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123},l={shift:{wanted:!1,pressed:!1},ctrl:{wanted:!1,pressed:!1},alt:{wanted:!1,pressed:!1},meta:{wanted:!1,pressed:!1}};d.ctrlKey&&(l.ctrl.pressed=!0),d.shiftKey&&(l.shift.pressed=!0),d.altKey&&(l.alt.pressed=!0),d.metaKey&&(l.meta.pressed=!0);for(var m=0;k=g[m],m<g.length;m++)k=="ctrl"||k=="control"?(h++,l.ctrl.wanted=!0):k=="shift"?(h++,l.shift.wanted=!0):k=="alt"?(h++,l.alt.wanted=!0):k=="meta"?(h++,l.meta.wanted=!0):k.length>1?j[k]==code&&h++:c.keycode?c["keycode"]==code&&h++:f==k?h++:i[f]&&d.shiftKey&&(f=i[f],f==k&&h++);if(h==g.length&&l.ctrl.pressed==l.ctrl.wanted&&l.shift.pressed==l.shift.wanted&&l.alt.pressed==l.alt.wanted&&l.meta.pressed==l.meta.wanted){b(d);if(!c.propagate)return d.cancelBubble=!0,d.returnValue=!1,d.stopPropagation&&(d.stopPropagation(),d.preventDefault()),!1}};this.all_shortcuts[a]={callback:h,target:f,event:c.type},f.addEventListener?f.addEventListener(c.type,h,!1):f.attachEvent?f.attachEvent("on"+c.type,h):f["on"+c.type]=h},remove:function(a){a=a.toLowerCase();var b=this.all_shortcuts[a];delete this.all_shortcuts[a];if(!b)return;var c=b.event,d=b.target,e=b.callback;d.detachEvent?d.detachEvent("on"+c,e):d.removeEventListener?d.removeEventListener(c,e,!1):d["on"+c]=!1}};var Vendor=new Object;Vendor.insertContent=function(a,b){myField=document.getElementById(a);if(document.selection)myField.focus(),sel=document.selection.createRange(),sel.text=b,myField.focus();else if(myField.selectionStart||myField.selectionStart=="0"){var c=myField.selectionStart,d=myField.selectionEnd,e=myField.scrollTop;myField.value=myField.value.substring(0,c)+b+myField.value.substring(d,myField.value.length),myField.focus(),myField.selectionStart=c+b.length,myField.selectionEnd=c+b.length,myField.scrollTop=e}else myField.value+=b,myField.focus()},Vendor.copyToClipboard=function(a){if(a.createTextRange){var b=a.createTextRange();b&&b.execCommand("Copy")}else{var c="flashcopier";if(!document.getElementById(c)){var d=document.createElement("div");d.id=c,document.body.appendChild(d)}document.getElementById(c).innerHTML="";var e='<embed src="/images/_clipboard.swf" FlashVars="clipboard='+encodeURIComponent(a)+'" width="0" height="0" type="application/x-shockwave-flash"></embed>';document.getElementById(c).innerHTML=e}};var Rubular={lastMessageSent:0,lastMessageReceived:-1,testStringHasFocus:!1,inErrorState:!1,defaultRequestHeaders:function(){return{asynchronous:!0,evalScripts:!0}},example:function(){var a=new Date;$("regex").value="(?<month>\\d{1,2})\\/(?<day>\\d{1,2})\\/(?<year>\\d{4})",$("test").value="Today's date is: "+(a.getMonth()+1)+"/"+a.getDate()+"/"+a.getFullYear()+".",$("ruby_version").value="ruby_2_0_0"},clearFields:function(a,b,c,d){$("regex").value=Rubular.useIfDefined(a),$("options").value=Rubular.useIfDefined(b),$("test").value=Rubular.useIfDefined(c);var d=Rubular.useIfDefined(d);for(var e=0;e<$("ruby_version").options.length;++e){var f=$("ruby_version").options[e];f.value==d&&($("ruby_version").selectedIndex=e)}},useIfDefined:function(a){return typeof a=="undefined"?"":a},showSpinner:function(){$("ajax_loader_wrapper").show()},hideSpinner:function(){$("ajax_loader_wrapper").hide()},testRegex:function(a,b,c){var d=Object.extend({force:!1},c||{});if(this.isEditorEmpty()||this.inErrorState&&!d.force)return;this.showSpinner();var e=++this.lastMessageSent;new Ajax.Request("/regex/do_test?message_id="+e,Object.extend(this.defaultRequestHeaders(),{parameters:b,on0:this.onRegexParseError.bind(this,e),onFailure:this.onRegexParseError.bind(this,e)}))},onRegexParseError:function(a){this.lastMessageSent==a&&(this.recordLastMessageReceived(a),this.handleParseError("Oops, there was an error handling your regex. We'll try again in a few seconds."))},recordLastMessageReceived:function(a){this.lastMessageReceived=a},handleParseSuccess:function(){this.inErrorState=!1,this.hideSpinner(),this.clearNotice()},handleParseError:function(a){this.showNotice(a,{fade:!1}),this.inErrorState=!0,this.scheduleAutoRetry()},scheduleAutoRetry:function(){this.hideSpinner(),setTimeout(function(){this.showNotice("Ok, trying again...",{fade:!1}),this.showSpinner(),setTimeout(function(){this.testRegex($("test_form"),Form.serialize("test_form"),{force:!0})}.bind(this),3e3)}.bind(this),6e3)},isEditorEmpty:function(){return $("start_instructions")&&($("regex").value==""||$("test").value=="")},insertTab:function(){Vendor.insertContent("test",String.fromCharCode(9))},copyRegexToClipboard:function(){if($("regex").value=="")this.showNotice("Enter a regular expression first!");else{var a="/"+$F("regex")+"/"+$F("options");Vendor.copyToClipboard(a),this.showNotice("Your regex has been copied to your clipboard!")}},showNotice:function(a,b){var c={fade:!0};Object.extend(c,b||{});var d=$("ajax_note");d.innerHTML=a,d.show(),c.fade&&setTimeout(function(){d.innerHTML==a&&this.clearNotice()},6e3+a.length*10)},clearNotice:function(){$("ajax_note").innerHTML="",$("ajax_note").hide()},makePermalink:function(){this.isEditorEmpty()?this.showNotice("To create a permalink, first enter a regular expression and a test string."):new Ajax.Request("/regex/make_permalink",Object.extend(this.defaultRequestHeaders(),{parameters:Form.serialize("test_form"),onFailure:this.onRegexParseError}))}};Event.observe(window,"load",function(){shortcut.add("Control+Shift+S",function(){Rubular.testStringHasFocus&&Rubular.insertTab()}),$("test_form").getElements().each(function(a){Event.observe(a,"focus",function(a){Rubular.testStringHasFocus=Event.element(a).id=="test"})}),new Form.Observer("test_form",.2,function(a,b){Rubular.testRegex(a,b)})});